version: 1.0
frontend:
    phases:
        preBuild:
            commands:
                - nvm install 14.15.0
                - yarn install
        build:
            commands:
                - yarn run build
    artifacts:
        baseDirectory: public
        files:
            - '**/*'
    cache:
        paths:
            - node_modules/**/*

test:
    phases:
        preTest:
            commands:
                - rm -rf node_modules && yarn install --frozen-lockfile
                - yarn install wait-on
                - yarn install mocha@5.2.0 mochawesome mochawesome-merge mochawesome-report-generator
                - 'yarn start & yarn wait-on http://localhost:8000'
        test:
            commands:
                - 'yarn cypress run --reporter mochawesome --reporter-options "reportDir=cypress/report/mochawesome-report,overwrite=false,html=false,json=true,timestamp=mmddyyyy_HHMMss"'
        postTest:
            commands:
                - yarn mochawesome-merge cypress/report/mochawesome-report/mochawesome*.json > cypress/report/mochawesome.json
    artifacts:
        baseDirectory: cypress
        configFilePath: '**/mochawesome.json'
        files:
            - '**/*.png'
            - '**/*.mp4'